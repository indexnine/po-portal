<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indexnine PO Generator</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS STYLES */
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --text-color: #333;
            --light-bg: #f8fafc;
            --white: #ffffff;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Login Overlay */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: var(--white);
            padding: 3rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            text-align: center;
            width: 100%;
            max-width: 400px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-logo {
            max-height: 40px;
            /* Tiny logo as requested */
            margin-bottom: 20px;
            object-fit: contain;
        }

        .login-box h2 {
            margin-bottom: 2rem;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.5rem;
        }

        .login-box input {
            width: 100%;
            padding: 0.875rem 1rem;
            margin: 0.5rem 0;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .login-box input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .login-box button {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(to right, #2c3e50, #3498db);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            transition: transform 0.1s, opacity 0.2s;
        }

        .login-box button:hover {
            opacity: 0.9;
        }

        .login-box button:active {
            transform: scale(0.98);
        }

        #portal-content {
            display: none;
            padding: 40px 20px;
        }

        /* PO Paper Styling */
        .po-paper {
            background: var(--white);
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 60px;
            box-shadow: var(--shadow-lg);
            position: relative;
            box-sizing: border-box;
            border: 3px double var(--primary-color);
            /* Professional Border */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            /* Aligns content to bottom (line) */
            margin-bottom: 40px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            /* Minimal space above line */
        }

        .header-left {
            flex: 1;
            text-align: left;
        }

        .header-center {
            flex: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .header-right {
            flex: 1;
            text-align: right;
        }

        .header-center img {
            max-height: 40px;
            /* Tiny logo as requested */
            display: block;
            margin-bottom: 5px;
            /* Reduced margin */
        }

        .po-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary-color);
            letter-spacing: 1px;
            text-transform: uppercase;
            line-height: 1;
            /* Tight line height */
        }

        .meta-text {
            font-size: 0.95rem;
            color: #64748b;
            margin: 0;
            /* Remove margin to sit flush */
            line-height: 1.2;
        }

        .meta-text strong {
            color: var(--primary-color);
        }

        .address-container {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 40px;
            margin-bottom: 40px;
        }

        .consignee,
        .supplier {
            flex: 1;
            font-size: 0.95rem;
            line-height: 1.6;
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .consignee strong,
        .supplier strong {
            display: block;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.1rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 5px;
        }

        textarea {
            width: 100%;
            height: 100px;
            box-sizing: border-box;
            /* Fix for overflow issues */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0;
            /* Removed padding for alignment */
            font-family: inherit;
            resize: vertical;
            background: white;
            padding: 10px;
            /* Default for editing ease, will remove in print/adjusted below */
        }

        /* Specific style for Supplier TA to match alignment */
        .supplier textarea {
            background: transparent;
            border: 1px solid #ccc;
            /* Visible border for entry */
            padding: 10px;
            margin-top: 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .supplier textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            background: white;
        }

        /* Print Display Logic */
        .supplier-print-view {
            display: none;
            /* Hide on screen */
            white-space: pre-wrap;
            /* Preserve formatting */
            font-family: inherit;
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text-color);
            margin-top: 4px;
            /* Align with label */
        }

        /* Terms textarea */
        .terms-ta {
            padding: 10px;
        }

        .terms-container {
            margin-top: 40px;
            font-size: 0.9rem;
            color: #475569;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 30px 0;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            padding: 12px 15px;
        }

        td {
            border-bottom: 1px solid var(--border-color);
            padding: 12px 15px;
            font-size: 0.95rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .row-input {
            width: 100%;
            border: 1px solid transparent;
            padding: 5px;
            border-radius: 4px;
            font-family: inherit;
            background: transparent;
        }

        .row-input:focus {
            background: white;
            border-color: var(--accent-color);
            outline: none;
        }

        .summary-section {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #f1f5f9;
        }

        .words-col {
            flex: 1;
            padding-right: 40px;
            font-style: italic;
            color: #64748b;
        }

        .words-col strong {
            display: block;
            margin-bottom: 5px;
            color: var(--primary-color);
            font-style: normal;
        }

        .totals-col {
            width: 350px;
            text-align: right;
        }

        .totals-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .totals-row.grand-total {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            border-top: 2px solid var(--primary-color);
            padding-top: 10px;
            margin-top: 15px;
        }

        .tax-select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            font-family: inherit;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .footer {
            display: flex;
            justify-content: space-between;
            margin-top: 80px;
            align-items: flex-end;
            page-break-inside: avoid;
        }

        .stamp-area {
            text-align: center;
            width: 250px;
        }

        .stamp-img {
            height: 100px;
            object-fit: contain;
            display: block;
            margin: 10px auto;
        }

        .signatory-text {
            border-top: 1px solid #cbd5e1;
            padding-top: 10px;
            margin-top: 10px;
            font-weight: 600;
        }

        /* Buttons */
        .action-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #27ae60;
            color: white;
        }

        .btn-secondary {
            background: var(--primary-color);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.15);
        }

        #add-row-btn-container {
            margin-top: 10px;
            text-align: right;
        }

        .btn-sm {
            padding: 8px 16px;
            background: #e2e8f0;
            color: var(--primary-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .btn-sm:hover {
            background: #cbd5e1;
        }

        @media print {
            @page {
                size: A4;
                margin: 5mm;
                /* Maximize printable area */
            }

            body {
                margin: 0;
                padding: 0;
                background: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                zoom: 85%;
                /* Aggressive scale down to force single page (previously 90%) */
            }

            .action-buttons,
            .btn-sm,
            #login-overlay,
            .tax-select-container {
                display: none !important;
            }

            .po-paper {
                box-shadow: none;
                margin: 0;
                width: 100%;
                min-height: auto;
                /* Allow height to fit content */
                padding: 5mm;
                /* Very compact padding to save vertical space */
                border: 3px double var(--primary-color) !important;
                box-sizing: border-box;
            }

            /* Aggressive Spacing Compaction for Print */
            .header {
                margin-bottom: 10px;
                /* Reduced further */
                padding-bottom: 5px;
            }

            .address-container {
                margin-top: 10px;
                margin-bottom: 10px;
                gap: 20px;
            }

            .consignee,
            .supplier {
                padding: 8px;
                /* Reduced padding */
                background: none;
                border: 1px solid #ccc;
            }

            /* HIDE TEXTAREA IN PRINT */
            .supplier textarea {
                display: none;
            }

            /* SHOW PRINT DIV IN PRINT */
            .supplier-print-view {
                display: block;
            }

            .consignee strong,
            .supplier strong {
                margin-bottom: 4px;
                font-size: 1rem;
            }

            table {
                margin: 10px 0;
                /* Reduced margin */
            }

            th,
            td {
                padding: 5px 8px;
                /* Further reduced cell padding */
            }

            .summary-section {
                margin-top: 10px;
                padding-top: 10px;
            }

            textarea {
                height: auto;
                /* Adjust to content */
                min-height: 40px;
            }

            .terms-container {
                margin-top: 20px;
                /* Reduced from 40px */
            }

            .footer {
                margin-top: 10px;
                /* Reduced drastically from 80px/30px */
            }

            .stamp-img {
                height: 60px;
                /* Smaller stamp */
            }
        }

        /* Utility class to hide elements during print if needed */
        .no-print {
            display: none !important;
        }
    </style>
</head>

<body>

    <div id="login-overlay">
        <div class="login-box">
            <img src="assets/logo.png" alt="Indexnine Logo" class="login-logo">
            <h2>Login</h2>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="handleLogin()">Access Portal</button>
        </div>
    </div>

    <div id="portal-content">
        <div class="po-paper" id="po-document">
            <div class="header">
                <div class="header-left">
                    <div class="meta-text" id="po-number-val"><strong>PO No:</strong> ...</div>
                </div>
                <div class="header-center">
                    <img src="assets/logo.png" alt="Indexnine Logo">
                    <div class="po-title">PURCHASE ORDER</div>
                </div>
                <div class="header-right">
                    <div class="meta-text" id="date-val"><strong>Date:</strong> ...</div>
                </div>
            </div>

            <div class="address-container">
                <div class="consignee">
                    <strong>Consignee:</strong>
                    Indexnine Technologies Pvt. Ltd.<br>
                    12th Floor, Sadanand Business Center<br>
                    Pashan Highway Side Rd, Pune-411007
                </div>
                <div class="supplier">
                    <strong>Supplier:</strong>
                    <!-- Input for Screen -->
                    <textarea id="supplier-ta" placeholder="Enter Supplier Name, Address and GST..." spellcheck="false"
                        oninput="updateSupplierPrintView()"></textarea>

                    <!-- Display for Print -->
                    <div id="supplier-print-view" class="supplier-print-view"></div>
                </div>
            </div>

            <table id="po-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 50%;">Particulars</th>
                        <th style="width: 10%;">Qty</th>
                        <th style="width: 15%;">Rate (₹)</th>
                        <th style="width: 20%;">Amount (₹)</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="row-input" placeholder="Item description"></td>
                        <td><input type="number" class="row-input qty" value="0" min="0" oninput="calculateTotal()">
                        </td>
                        <td><input type="number" class="row-input rate" value="0" min="0" oninput="calculateTotal()">
                        </td>
                        <td class="amt-cell">0.00</td>
                    </tr>
                </tbody>
            </table>

            <div id="add-row-btn-container">
                <button class="btn-sm" onclick="addRow()">+ Add Item</button>
            </div>

            <div class="summary-section">
                <div class="words-col">
                    <strong>Amount in Words:</strong>
                    <span id="amount-in-words">Rupees Zero Only</span>
                </div>
                <div class="totals-col">
                    <div class="totals-row">
                        <span>Sub Total:</span>
                        <span>₹ <span id="sub-total">0.00</span></span>
                    </div>

                    <!-- Tax Section -->
                    <div class="totals-row">
                        <span class="tax-label-container">
                            Tax
                            <span class="tax-select-container">
                                <select id="tax-type" class="tax-select" onchange="calculateTotal()">
                                    <option value="cgst_sgst">CGST (9%) + SGST (9%)</option>
                                    <option value="igst">IGST (18%)</option>
                                </select>
                            </span>
                        </span>
                        <span></span>
                    </div>

                    <!-- Dynamic Tax Rows Container -->
                    <div id="tax-rows-container">
                        <!-- JS will inject rows here -->
                    </div>

                    <!-- Round Off Row -->
                    <div class="totals-row" id="round-off-container" style="display: none;">
                        <span>Round Off:</span>
                        <span><span id="round-off-val">0.00</span></span>
                    </div>

                    <div class="totals-row grand-total">
                        <span>Total:</span>
                        <span>₹ <span id="grand-total">0.00</span></span>
                    </div>
                </div>
            </div>

            <div class="terms-container">
                <strong style="color: var(--primary-color);">Terms & Conditions:</strong><br>
                <textarea class="terms-ta" style="height: 60px; margin-top: 5px; color: #475569;"
                    spellcheck="false"></textarea>
            </div>

            <div class="footer">
                <div></div>
                <div class="stamp-area">
                    <p style="font-size: 0.9rem; color: #475569;">For Indexnine Technologies Pvt. Ltd.</p>
                    <img src="assets/stamp.png" alt="Company Stamp" class="stamp-img">
                    <div class="signatory-text">Authorised Signatory</div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="window.print()">Download PDF</button>
        </div>
    </div>

    <script>
        // Sync Function
        function updateSupplierPrintView() {
            const ta = document.getElementById('supplier-ta');
            const view = document.getElementById('supplier-print-view');

            // Handle if element not found just in case but safe in this static file
            if (ta && view) {
                view.innerText = ta.value;
            }
        }

        function handleLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if (u === "Admin" && p === "Admin@123") {
                const overlay = document.getElementById('login-overlay');
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                    document.getElementById('portal-content').style.display = 'block';
                }, 300);

                // Set current date
                const today = new Date();
                const formattedDate = today.getDate() + '/' + today.toLocaleString('default', { month: 'short' }) + '/' + today.getFullYear().toString().substr(-2);
                document.getElementById('date-val').innerHTML = "<strong>Date:</strong> " + formattedDate;

                // Auto Generate PO Number with LocalStorage
                // Start from PO-2026-001
                let currentSeq = localStorage.getItem('po_seq');

                if (!currentSeq) {
                    currentSeq = 1;
                } else {
                    currentSeq = parseInt(currentSeq) + 1;
                }

                localStorage.setItem('po_seq', currentSeq);

                // Pad with zeros (e.g., 001)
                const seqStr = currentSeq.toString().padStart(3, '0');
                const poNum = "PO-2026-" + seqStr;

                document.getElementById('po-number-val').innerHTML = "<strong>PO No:</strong> " + poNum;

                // Initial calc
                calculateTotal();

            } else {
                alert("Invalid Credentials");
            }
        }

        function addRow() {
            const table = document.getElementById('table-body');
            const rowCount = table.rows.length + 1;
            const row = table.insertRow(-1);
            row.innerHTML = `<td>${rowCount}</td><td><input type="text" class="row-input"></td><td><input type="number" class="row-input qty" value="0" min="0" oninput="calculateTotal()"></td><td><input type="number" class="row-input rate" value="0" min="0" oninput="calculateTotal()"></td><td class="amt-cell">0.00</td>`;
        }

        function calculateTotal() {
            let subTotal = 0;
            const rows = document.querySelectorAll('#table-body tr');
            rows.forEach(row => {
                const qty = parseFloat(row.querySelector('.qty').value) || 0;
                const rate = parseFloat(row.querySelector('.rate').value) || 0;
                const amt = qty * rate;
                row.querySelector('.amt-cell').innerText = amt.toLocaleString('en-IN', { minimumFractionDigits: 2 });
                subTotal += amt;
            });

            document.getElementById('sub-total').innerText = subTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 });

            // Tax Calculation
            const taxType = document.getElementById('tax-type').value;
            const taxContainer = document.getElementById('tax-rows-container');
            let totalTaxAmt = 0;

            if (taxType === 'igst') {
                const taxAmt = subTotal * 0.18;
                totalTaxAmt = taxAmt;
                taxContainer.innerHTML = `
                    <div class="totals-row">
                        <span>IGST (18%):</span>
                        <span>₹ ${taxAmt.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>
                    </div>
                `;
            } else {
                const taxAmt = subTotal * 0.09;
                totalTaxAmt = taxAmt * 2;
                taxContainer.innerHTML = `
                    <div class="totals-row">
                        <span>CGST (9%):</span>
                        <span>₹ ${taxAmt.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>
                    </div>
                    <div class="totals-row">
                        <span>SGST (9%):</span>
                        <span>₹ ${taxAmt.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</span>
                    </div>
                `;
            }

            const rawGrandTotal = subTotal + totalTaxAmt;
            const roundedTotal = Math.round(rawGrandTotal);
            const roundOffAmt = roundedTotal - rawGrandTotal;

            // Round Off Display Logic
            const roundOffContainer = document.getElementById('round-off-container');
            const roundOffVal = document.getElementById('round-off-val');

            if (Math.abs(roundOffAmt) > 0.001) {
                roundOffContainer.style.display = 'flex';
                // Show sign explicitly
                const sign = roundOffAmt > 0 ? '+' : '';
                roundOffVal.innerText = sign + roundOffAmt.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            } else {
                roundOffContainer.style.display = 'none';
            }

            document.getElementById('grand-total').innerText = roundedTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 });

            document.getElementById('amount-in-words').innerText = "Rupees " + numberToWords(roundedTotal) + " Only";
        }

        function numberToWords(n) {
            if (n === 0) return "Zero";
            const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

            if (n < 20) return a[n];
            if (n < 100) return b[Math.floor(n / 10)] + " " + a[n % 10];
            if (n < 1000) return a[Math.floor(n / 100)] + "Hundred " + numberToWords(n % 100);
            if (n < 100000) return numberToWords(Math.floor(n / 1000)) + "Thousand " + numberToWords(n % 1000);
            if (n < 10000000) return numberToWords(Math.floor(n / 100000)) + "Lakh " + numberToWords(n % 100000);
            return numberToWords(Math.floor(n / 10000000)) + "Crore " + numberToWords(n % 10000000);
        }
    </script>
</body>

</html>